<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Platform Manager | SixSeven</title>
<style>
    * { box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; background: #f5f7fa; padding: 20px; }
    .card { background: white; padding: 40px; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.15); width: 100%; max-width: 680px; max-height: 90vh; overflow-y: auto; position: relative; }
    .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; padding-bottom: 24px; border-bottom: 2px solid #f0f2f5; }
    .header h2 { margin: 0; font-size: 28px; font-weight: 600; color: #1a1a2e; letter-spacing: -0.5px; }
    .header-actions { display: flex; gap: 12px; align-items: center; }
    .report-btn { background: #8b5cf6; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 2px 8px rgba(139, 92, 246, 0.2); }
    .report-btn:hover { background: #7c3aed; }
    .logout-btn { background: #ef4444; color: white; padding: 10px 20px; text-decoration: none; border-radius: 8px; border: none; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.2); }
    .logout-btn:hover { background: #dc2626; }
    .search-section { margin-bottom: 28px; }
    .search-bar { display: flex; gap: 12px; }
    .search-bar input { flex: 1; padding: 12px 16px; border: 2px solid #e5e7eb; border-radius: 10px; font-size: 15px; color: #374151; background: #f9fafb; }
    .search-bar input:focus { outline: none; border-color: #667eea; background: white; }
    .search-bar button { background: #667eea; color: white; border: none; border-radius: 10px; padding: 12px 24px; cursor: pointer; font-size: 14px; font-weight: 500; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2); }
    .search-bar button:hover { background: #5568d3; }
    .category-list { margin-top: 24px; min-height: 100px; }
    .category-item { display: flex; justify-content: space-between; align-items: center; background: #f9fafb; padding: 16px 20px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #e5e7eb; }
    .category-item span { font-size: 15px; color: #374151; font-weight: 500; }
    .delete-btn { background: #ef4444; border: none; color: white; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 500; }
    .delete-btn:hover { background: #dc2626; }
    .add-btn { background: #e5e7eb; color: white; border: none; padding: 14px; border-radius: 10px; cursor: pointer; font-size: 15px; font-weight: 500; width: 100%; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.2); margin-top: 16px; }
    .add-btn:hover { background: #e5e7eb79; }
    .new-category-form { display: none; margin-top: 16px; background: #eff6ff; padding: 20px; border-radius: 12px; border: 2px solid #dbeafe; }
    .new-category-form input { width: 100%; padding: 12px 16px; border: 2px solid #bfdbfe; border-radius: 10px; margin-bottom: 12px; font-size: 15px; background: white; }
    .new-category-form input:focus { outline: none; border-color: #667eea; }
    .confirm-btn { background: #667eea; color: white; border: none; padding: 12px 24px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 500; width: 100%; }
    .confirm-btn:hover { background: #5568d3; }
</style>
</head>
<body>
<div class="card">
    <div class="header">
        <h2>Platform Manager</h2>
        <div class="header-actions">
            <button class="report-btn" onclick="window.location.href='/reports'">üìä Reports</button>
            <button class="logout-btn" onclick="window.location.href='/logout'">üö™ Logout</button>
        </div>
    </div>

    <!-- Search bar -->
    <div class="search-section">
        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search categories...">
            <button onclick="searchCategories()">üîç Search</button>
        </div>
    </div>

    <!-- Categories List -->
    <div id="categories" class="category-list">
        Loading categories...
    </div>

    <!-- Add Category -->
    <button class="add-btn" onclick="toggleNewCategory()"><img src="data:image/png;base64,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" width="16" height="16"></button>
    <div id="newCategoryForm" class="new-category-form">
        <input type="text" id="newCategoryName" placeholder="Enter new category name">
        <button class="confirm-btn" onclick="addCategory()">Confirm</button>
    </div>
</div>

<script>
// Fetch categories from backend
async function loadCategories() {
    try {
        const res = await fetch('/platform_manager/api/read');
        if (!res.ok) throw new Error('Failed to fetch categories');
        const categories = await res.json();
        const container = document.getElementById('categories');
        
        if (!categories || categories.length === 0) {
            container.innerHTML = '<div class="category-item">No categories found</div>';
            return;
        }
        
        container.innerHTML = '';
        categories.forEach(cat => {
            const div = document.createElement('div');
            div.className = 'category-item';
            div.innerHTML = `
                <span>${cat.name}</span>
                <button class="delete-btn" onclick="deleteCategory(${cat.id})">Delete</button>
            `;
            container.appendChild(div);
        });
    } catch(err) {
        console.error('Error loading categories:', err);
        document.getElementById('categories').innerHTML = '<div class="category-item">Error loading categories</div>';
    }
}

// Search categories
function searchCategories() {
    const term = document.getElementById('searchInput').value.toLowerCase();
    const items = document.querySelectorAll('.category-item');
    
    if (items.length === 0) return;
    
    items.forEach(item => {
        const name = item.querySelector('span').textContent.toLowerCase();
        item.style.display = name.includes(term) ? 'flex' : 'none';
    });
}

// Toggle new category form
function toggleNewCategory() {
    const form = document.getElementById('newCategoryForm');
    form.style.display = form.style.display === 'block' ? 'none' : 'block';
}

// Add category
async function addCategory() {
    const name = document.getElementById('newCategoryName').value.trim();
    if (!name) return alert('Please enter a category name');
    
    try {
        const res = await fetch('/platform_manager/api/create', {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({category_name: name})
        });
        
        const data = await res.json();
        if (data.success) {
            document.getElementById('newCategoryName').value = '';
            toggleNewCategory();
            loadCategories();
        } else {
            alert(data.error || 'Error adding category');
        }
    } catch(err) {
        console.error('Error adding category:', err);
        alert('Error adding category');
    }
}

// Delete category
async function deleteCategory(id) {    
    try {
        const res = await fetch('/platform_manager/api/delete', {
            method: 'DELETE',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify({id: id})
        });
        
        const data = await res.json();
        if (data.success) {
            loadCategories();
        } else {
            alert(data.error || 'Error deleting category');
        }
    } catch(err) {
        console.error('Error deleting category:', err);
        alert('Error deleting category');
    }
}

// Initial load when page opens
document.addEventListener('DOMContentLoaded', function() {
    loadCategories();
});
</script>
</body>
</html>