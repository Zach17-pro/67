<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSR Rep Dashboard</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      display: flex;
      background: #f4f6f8;
    }
    nav {
      width: 230px;
      background: #2c3e50;
      color: white;
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      overflow-y: auto;
    }
    nav h2 {
      text-align: center;
      padding: 15px;
      background: #1a252f;
      margin: 0;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    nav li a {
      display: block;
      padding: 12px 15px;
      color: white;
      text-decoration: none;
    }
    nav li a:hover, nav li a.active {
      background: #3498db;
    }
    main {
      margin-left: 230px;
      padding: 25px;
      width: 100%;
    }
    section {
      display: none;
    }
    section.active {
      display: block;
      animation: fade 0.3s;
    }
    @keyframes fade {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    button {
      background: #3498db;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
    input, select {
      padding: 8px;
      margin: 5px;
      width: 200px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #ecf0f1;
    }
  </style>
</head>
<body>
  <nav>
    <h2>CSR Rep</h2>
    <ul>
      <li><a href="#" class="active" onclick="showSection('searchRequests')">Search PIN Requests</a></li>
      <li><a href="#" onclick="showSection('viewRequest')">View Request Details</a></li>
      <li><a href="#" onclick="showSection('saveShortlist')">Save to Shortlist</a></li>
      <li><a href="#" onclick="showSection('searchShortlist')">Search Shortlist</a></li>
      <li><a href="#" onclick="showSection('viewShortlist')">View Shortlist</a></li>
      <li><a href="#" onclick="showSection('searchPastMatches')">Search Past Matches</a></li>
      <li><a href="#" onclick="showSection('viewPastMatches')">View Past Matches</a></li>
      <li><a href="#" style="background:#e74c3c; text-align:center;" onclick="logout()">Logout</a></li>
    </ul>
</nav>


  <main>
    <!-- 1️⃣ Search PIN Requests -->
    <section id="searchRequests" class="active">
      <div class="card">
        <h2>Search PIN Requests</h2>
        <input type="text" id="searchQuery" placeholder="Enter keyword">
        <button onclick="searchRequests()">Search</button>
        <table id="searchResults"><thead><tr><th>ID</th><th>Title</th><th>Status</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- 2️⃣ View Request Details -->
    <section id="viewRequest">
      <div class="card">
        <h2>View Request Details</h2>
        <input type="number" id="requestId" placeholder="Enter Request ID">
        <button onclick="viewRequest()">View</button>
        <pre id="requestDetails"></pre>
      </div>
    </section>

    <!-- 3️⃣ Save to Shortlist -->
    <section id="saveShortlist">
      <div class="card">
        <h2>Save to Shortlist</h2>
        <input type="number" id="shortlistReqId" placeholder="Request ID">
        <input type="number" id="shortlistRepId" placeholder="Rep ID">
        <button onclick="saveShortlist()">Save</button>
        <p id="saveShortlistMsg"></p>
      </div>
    </section>

    <!-- 4️⃣ Search Shortlist -->
    <section id="searchShortlist">
      <div class="card">
        <h2>Search Shortlist</h2>
        <input type="number" id="searchRepId" placeholder="Rep ID">
        <input type="text" id="shortlistKeyword" placeholder="Keyword">
        <button onclick="searchShortlist()">Search</button>
        <table id="shortlistResults"><thead><tr><th>ID</th><th>Title</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- 5️⃣ View Shortlist -->
    <section id="viewShortlist">
      <div class="card">
        <h2>View Shortlist</h2>
        <input type="number" id="viewRepId" placeholder="Rep ID">
        <button onclick="viewShortlist()">View</button>
        <table id="viewShortlistTable"><thead><tr><th>ID</th><th>Request</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- 6️⃣ Search Past Matches -->
    <section id="searchPastMatches">
      <div class="card">
        <h2>Search Past Matches</h2>
        <input type="text" id="service" placeholder="Service">
        <input type="date" id="startDate">
        <input type="date" id="endDate">
        <button onclick="searchPastMatches()">Search</button>
        <table id="pastMatchesTable"><thead><tr><th>Match ID</th><th>Service</th><th>Date</th></tr></thead><tbody></tbody></table>
      </div>
    </section>

    <!-- 7️⃣ View Past Matches -->
    <section id="viewPastMatches">
      <div class="card">
        <h2>View Past Matches</h2>
        <input type="text" id="viewService" placeholder="Service">
        <input type="date" id="viewStart">
        <input type="date" id="viewEnd">
        <button onclick="viewPastMatches()">View</button>
        <table id="viewPastTable"><thead><tr><th>Match ID</th><th>Service</th><th>Date</th></tr></thead><tbody></tbody></table>
      </div>
    </section>
  </main>

  <script>
    // Navigation
    function showSection(id) {
      document.querySelectorAll('nav a').forEach(a => a.classList.remove('active'));
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      document.querySelector(`nav a[onclick="showSection('${id}')"]`).classList.add('active');
      document.getElementById(id).classList.add('active');
    }

    // 1️⃣ Search PIN Requests
    async function searchRequests() {
      const q = document.getElementById('searchQuery').value;
      const res = await fetch(`/api/csr/search?query=${encodeURIComponent(q)}`);
      const data = await res.json();
      const tbody = document.querySelector('#searchResults tbody');
      tbody.innerHTML = data.map(r => `<tr><td>${r.id}</td><td>${r.title || ''}</td><td>${r.status || ''}</td></tr>`).join('');
    }

    // 2️⃣ View Request Details
    async function viewRequest() {
      const id = document.getElementById('requestId').value;
      const res = await fetch(`/api/csr_rep/view_request/${id}`);
      const data = await res.json();
      document.getElementById('requestDetails').textContent = JSON.stringify(data, null, 2);
    }

    // 3️⃣ Save to Shortlist
    async function saveShortlist() {
      const reqId = document.getElementById('shortlistReqId').value;
      const repId = document.getElementById('shortlistRepId').value;
      const res = await fetch(`/api/csr_rep/save_shortlist`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ request_id: reqId, rep_id: repId })
      });
      const data = await res.json();
      document.getElementById('saveShortlistMsg').textContent = data.success ? "Saved!" : data.error;
    }

    // 4️⃣ Search Shortlist
    async function searchShortlist() {
      const repId = document.getElementById('searchRepId').value;
      const keyword = document.getElementById('shortlistKeyword').value;
      const res = await fetch(`/api/csr_rep/search_shortlist?rep_id=${repId}&keyword=${encodeURIComponent(keyword)}`);
      const data = await res.json();
      const tbody = document.querySelector('#shortlistResults tbody');
      tbody.innerHTML = data.map(r => `<tr><td>${r.id}</td><td>${r.title || ''}</td></tr>`).join('');
    }

    // 5️⃣ View Shortlist
    async function viewShortlist() {
      const repId = document.getElementById('viewRepId').value;
      const res = await fetch(`/api/csr_rep/view_shortlist/${repId}`);
      const data = await res.json();
      const tbody = document.querySelector('#viewShortlistTable tbody');
      tbody.innerHTML = data.map(r => `<tr><td>${r.id}</td><td>${r.title || ''}</td></tr>`).join('');
    }

    // 6️⃣ Search Past Matches
    async function searchPastMatches() {
      const service = document.getElementById('service').value;
      const start = document.getElementById('startDate').value;
      const end = document.getElementById('endDate').value;
      const res = await fetch(`/api/csr_rep/search_past_matches?service=${service}&start_date=${start}&end_date=${end}`);
      const data = await res.json();
      const tbody = document.querySelector('#pastMatchesTable tbody');
      tbody.innerHTML = data.map(m => `<tr><td>${m.id}</td><td>${m.service || ''}</td><td>${m.date || ''}</td></tr>`).join('');
    }

    // 7️⃣ View Past Matches
    async function viewPastMatches() {
      const service = document.getElementById('viewService').value;
      const start = document.getElementById('viewStart').value;
      const end = document.getElementById('viewEnd').value;
      const res = await fetch(`/api/csr_rep/view_past_matches?service=${service}&start_date=${start}&end_date=${end}`);
      const data = await res.json();
      const tbody = document.querySelector('#viewPastTable tbody');
      tbody.innerHTML = data.map(m => `<tr><td>${m.id}</td><td>${m.service || ''}</td><td>${m.date || ''}</td></tr>`).join('');
    }

    function logout() {
      // Just redirect to logout URL
      window.location.href = '/logout';
    }


  </script>
</body>
</html>